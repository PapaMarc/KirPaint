<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>PhotoSwipe Minimal Test</title>
    <link rel="stylesheet" href="https://unpkg.com/photoswipe@5/dist/photoswipe.css">
    <link rel="stylesheet" href="https://unpkg.com/photoswipe@5/dist/photoswipe-lightbox.css">
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            padding: 20px
        }

        #gallery a {
            display: inline-block;
            margin: 6px
        }

        #gallery img {
            width: 200px;
            height: 150px;
            object-fit: cover;
            border: 1px solid #ccc
        }

        #test-caption {
            position: fixed;
            left: 20px;
            right: 20px;
            bottom: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 8px;
            border-radius: 4px;
            font-size: 14px
        }
    </style>
</head>

<body>
    <h1>PhotoSwipe Minimal Test</h1>
    <p>Click thumbnails to open PhotoSwipe. Rapidly navigate with arrows to test caption updates.</p>
    <div id="gallery"></div>

    <div id="test-caption" aria-hidden="false"></div>

    <!-- PhotoSwipe vendor files will be loaded on demand by the controls below -->

    <!-- Controls: show which PhotoSwipe variant is being used and allow switching -->
    <script>
        (function () {
            // create container under the gallery (will insert after #gallery)
            var gallery = document.getElementById('gallery');
            var cont = document.createElement('div');
            cont.id = 'test-controls';
            cont.style.marginTop = '12px';

            var status = document.createElement('div');
            status.id = 'test-status';
            status.style.background = 'rgba(0,0,0,0.75)';
            status.style.color = '#fff';
            status.style.padding = '6px 8px';
            status.style.borderRadius = '6px';
            status.style.fontSize = '13px';
            status.style.display = 'block';
            status.style.marginBottom = '6px';

            // full path display
            var pathsBox = document.createElement('div');
            pathsBox.id = 'pswp-paths';
            pathsBox.style.fontSize = '12px';
            pathsBox.style.color = '#333';
            pathsBox.style.marginBottom = '6px';

            var label = document.createElement('label');
            label.textContent = 'PhotoSwipe variant: ';
            label.style.display = 'block';
            label.style.marginBottom = '4px';

            var select = document.createElement('select');
            select.id = 'pswp-variant-select';
            select.style.display = 'block';
            select.style.marginBottom = '8px';

            var opV3 = document.createElement('option'); opV3.value = 'v3'; opV3.textContent = 'v3 wrappers (../photoswipe/)';
            var opPhotoswipe = document.createElement('option'); opPhotoswipe.value = 'photoswipe'; opPhotoswipe.textContent = 'photoswipe (../photoswipe/)';
            var opVendor = document.createElement('option'); opVendor.value = 'vendor'; opVendor.textContent = 'vendor (vendor/)';
            var opCdn = document.createElement('option'); opCdn.value = 'cdn'; opCdn.textContent = 'cdn (unpkg)';
            var opNone = document.createElement('option'); opNone.value = 'none'; opNone.textContent = 'none (use fallback)';
            select.appendChild(opV3); select.appendChild(opPhotoswipe); select.appendChild(opVendor); select.appendChild(opCdn); select.appendChild(opNone);

            var btn = document.createElement('button'); btn.id = 'pswp-run'; btn.textContent = 'Load/Reload test-init.js'; btn.style.marginRight = '8px';
            var info = document.createElement('span'); info.id = 'pswp-info'; info.style.marginLeft = '6px'; info.style.color = '#666';

            cont.appendChild(status);
            cont.appendChild(pathsBox);
            cont.appendChild(label);
            cont.appendChild(select);
            cont.appendChild(btn);
            cont.appendChild(info);

            // insert after gallery
            if (gallery && gallery.parentNode) gallery.parentNode.insertBefore(cont, gallery.nextSibling);
            else document.body.appendChild(cont);

            function updateStatus(msg, paths) {
                status.textContent = 'Using: ' + msg; window.__r2_photoswipe_using = msg; pathsBox.innerHTML = '';
                if (Array.isArray(paths)) {
                    paths.forEach(function (p) { var d = document.createElement('div'); d.textContent = p; d.style.fontFamily = 'monospace'; d.style.fontSize = '12px'; pathsBox.appendChild(d); });
                }
            }

            var variants = {
                'v3': ['../photoswipe/v3photoswipe.umd.min.js', '../photoswipe/v3photoswipe-lightbox.umd.min.js'],
                'photoswipe': ['../photoswipe/photoswipe.umd.min.js', '../photoswipe/photoswipe-lightbox.umd.min.js'],
                'vendor': ['vendor/photoswipe.umd.min.js', 'vendor/photoswipe-lightbox.umd.min.js'],
                'cdn': ['https://unpkg.com/photoswipe@5/dist/photoswipe.umd.min.js', 'https://unpkg.com/photoswipe@5/dist/photoswipe-lightbox.umd.min.js'],
                'none': []
            };

            // choose default based on what files exist (simple heuristic: prefer ../photoswipe)
            select.value = 'photoswipe';

            function loadScripts(urls, cb) {
                if (!urls || !urls.length) return cb && cb();
                var i = 0;
                function next() { if (i >= urls.length) return cb && cb(); var s = document.createElement('script'); s.src = urls[i] + '?ts=' + Date.now(); s.onload = function () { i++; next(); }; s.onerror = function () { console.warn('failed to load', urls[i]); i++; next(); }; document.head.appendChild(s); }
                next();
            }

            function applyAndLoad(name) {
                var paths = variants[name] || [];
                updateStatus('loading...', paths);
                // remove any previous pswp globals
                try { delete window.PhotoSwipe; delete window.PhotoSwipeLightbox; delete window.V3_PhotoSwipe; delete window.V3_PhotoSwipeLightbox; } catch (e) { }
                loadScripts(paths, function () {
                    // after loading scripts, if v3 option chosen, try to prefer v3 wrappers
                    if (name === 'v3') {
                        if (window.V3_PhotoSwipe) try { window.PhotoSwipe = window.V3_PhotoSwipe; } catch (e) { }
                        if (window.V3_PhotoSwipeLightbox) try { window.PhotoSwipeLightbox = window.V3_PhotoSwipeLightbox; } catch (e) { }
                        updateStatus('v3 wrappers', paths);
                    } else if (name === 'photoswipe' || name === 'vendor' || name === 'cdn') {
                        updateStatus(name + ' loaded', paths);
                    } else {
                        updateStatus('none (fallback)', []);
                    }
                    // finally load test-init.js after libs
                    loadTestInit();
                });
            }

            function loadTestInit() {
                var old = document.getElementById('test-init-script'); if (old) old.remove(); try { window.__test_lightbox = undefined; } catch (e) { }
                var s = document.createElement('script'); s.id = 'test-init-script'; s.src = 'test-init.js?ts=' + Date.now(); s.onload = function () { info.textContent = ' initialized'; }; s.onerror = function () { info.textContent = ' load failed'; };
                document.body.appendChild(s);
            }

            btn.addEventListener('click', function () { applyAndLoad(select.value); });

            // initial load
            applyAndLoad(select.value);
        })();
    </script>
</body>

</html>